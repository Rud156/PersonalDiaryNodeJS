<link rel="stylesheet" href="/stylesheets/flatpickr.css" />
<style>
    #rightPane{
        background: url('/images/diary_1.jpg');
        background-size: cover;
        background-repeat: no-repeat;
        height: 80vh;
    }
    .transparent{
        background: transparent;
    }
</style>
<script src="/javascripts/flatpickr.js"></script>
<script src="/javascripts/tinymce.min.js"></script>
<nav class="w3-sidenav w3-purple w3-card-8" id="leftPane" style="width: 15%">
    <a href="javascript:void(0)" class="w3-center w3-xlarge" onclick="displayOnClick()">Open Editor</a>
    {{#each user.documents}}
    <a href="/users/{{hash}}">{{title}}</a>
    {{/each}}
</nav>

{{#if docObj}}
<div style="margin-left: 15%; padding-left: 30px">
    <span class="w3-xlarge">
        Title: <span class="w3-text-blue">{{docObj.title}}</span>
        <br> 
        Date: <span class="w3-text-green">{{docObj.date}}</span>
    </span>
    <br> 
    <div class="w3-container w3-xlarge w3-sand" id="userContent">
        {{unescapeContent docObj.content}}
    </div>
</div>
{{else}}
<div style="margin-left: 15%" id="rightPane">
    <div class="w3-container">
        <form id="textEditorHolder" class="w3-card-8 w3-margin-top w3-center" style="display: none" method="POST" action="/users/save">
            <div class="w3-panel" style="text-align: left">
                <div class="w3-half">
                    <label class="w3-label w3-xlarge w3-center w3-text-cyan">Title: </label>
                    <input type="text" class="w3-input w3-large w3-center w3-text-amber transparent" placeholder="Title" required name="title">
                </div>
                <div class="w3-half">
                    <label class="w3-label w3-xlarge w3-center w3-text-cyan">Date: </label>
                    <input type="text" class="flatpickr w3-input w3-large w3-center w3-text-amber transparent" placeholder="Date" required name="date">
                </div>
                <input type="text" class="w3-hide" id="userText" name="userText"/>
            </div>
            <textarea id="editor"></textarea>
            <button class="w3-btn w3-margin-top w3-margin-bottom w3-border w3-border-red w3-round-large w3-text-amber transparent" onclick="saveText()">
                Submit Page
            </button>
        </form>
    </div>
    <div id="contentArea">
        <div class="w3-card-8 w3-xlarge w3-center w3-margin-top w3-padding-24" id="noElements">
            No Items To Display Now.
            <br> <br>
            <button class="w3-btn w3-red w3-hover-green w3-round-large w3-xlarge w3-border w3-ripple" onclick="displayOnClick()">
                    Click Here to Create a New Page
            </button>
        </div>
    </div>
</div>
{{/if}}
<script>
    var editor = document.getElementById('textEditorHolder');
    var noDisplay = document.getElementById('noElements');
    function displayOnClick(){
        noDisplay.style.display = "none";
        editor.style.display = "block";
    }

    var dateInput = document.getElementsByName('date')[0];
    var date = new Date();
    if(dateInput)
        dateInput.value = date.getFullYear() + "-" + date.getMonth() + "-" + date.getDate();

    flatpickr('.flatpickr');
</script>
<script>
    var userText = document.getElementById('userText');
    var iFrame = null;
    tinymce.init({
        selector: '#editor',
        theme: 'modern',
        plugins: ['image textcolor spellchecker insertdatetime'],
        toolbar: 'undo redo | bold italic | alignleft aligncenter alignright alignjustify | link image | bullist numlist outdent indent | emoticons',
        setup: function (editor) {
            editor.on('init', function (e) {
            iFrame = document.getElementById('editor_ifr');
            iFrame = iFrame.contentWindow || iFrame.contentDocument;
            });
        }
    });
    function saveText(event){
        var document = iFrame.document.body.innerHTML;
        document = encodeURI(document);
        userText.value = document;
        console.log(document);
    }
</script>
<script>
    document.getElementById('userContent').innerHTML = document.getElementById('userContent').innerText;
</script>